# $Id: Portfile 120565 2014-06-01 16:53:49Z cal@macports.org $

PortSystem 1.0

name                samba4
version             4.1.14
revision            1
categories          net
platforms           darwin
maintainers         lausa.at:thomas.kotzian
license             GPL-3
description         SMB/CIFS server and client
long_description    Samba is an software suite that provides seamless file \
                    and print services to SMB/CIFS clients. \
                    \
                    Original port by mww

homepage            http://www.samba.org/
master_sites        http://mirror.kent.ac.uk/sites/ftp.samba.org/ \
                    http://us1.samba.org/samba/ftp/stable/ \
                    ftp://ftp.bit.nl/mirror/samba/stable/ \
                    ftp://de.samba.org/samba.org/stable/ \
                    ftp://us4.samba.org/pub/samba/stable/ \
                    ftp://ru.samba.org/pub/samba/stable/
distname            samba-${version}
checksums           md5     9f7bae123ed39d2aa9ba842d3a138d54 \
                    rmd160  b0165580cf3b76a6c22c28f817993d4dcfd17a42 \
                    sha256  5ea14baaca997292355d368918879e3d639def92b54efef2279cf5abe8db2cba

depends_lib		port:gnutls port:readline port:libiconv port:popt port:sqlite3 port:zlib port:gettext

worksrcdir		samba-${version}

configure.args      --with-fhs \
                    --mandir=${prefix}/share/man \
                    --with-libiconv=${prefix} \
                    --with-readline=${prefix} \
                    --with-sqlite3

destroot.target-append  installman
post-destroot {
	# add a postfix of '4' to all executables to avoid file conflicts
	foreach dir {bin sbin} {
		foreach bin [glob -directory "${destroot}${prefix}/${dir}" -type f *] {
			file rename "${bin}" "${bin}4"
		}
	}
	# ..and also to the manpages
	foreach dir [glob -directory "${destroot}${prefix}/share/man" "man\[138\]"] {
		foreach man [glob -directory "${dir}" -type f *] {
			file rename "${man}" [string range "${man}" 0 [expr [string last . "${man}"] - 1]]4[string range "${man}" [string last . "${man}"] [string length "${man}"]]
		}
	}
}

livecheck.type	regex
livecheck.url	http://us4.samba.org/samba/ftp/samba4/?M=D
livecheck.regex	samba-(\[0-9a-z.\]+)\\.tar\\.gz
