# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:filetype=tcl:et:sw=4:ts=4:sts=4
# $Id: Portfile 132561 2015-02-04 20:21:01Z mww@macports.org $

PortSystem          1.0

name                imapsync
version             1.670
categories          mail
platforms           darwin
maintainers         mww openmaintainer
license             WTFPL-2
description         imapsync is an IMAP synchronization, copy or migration tool.
long_description    imapsync is an IMAP synchronization, copy or migration \
                    tool. Synchronize mailboxes between two imap servers. It is \
                    especially good at IMAP migration.

homepage            http://imapsync.lamiral.info
master_sites        https://github.com/imapsync/imapsync/archive/

checksums           rmd160  a11b57960a439278a37cd377651aba6d64a65187 \
                    sha256  0a02a60899850a2aa8b7642a1caebda951437e2eb530f32489b10e651e957a29

worksrcdir          imapsync-imapsync-${version}

set perl_version    5.22
depends_run         port:perl${perl_version} \
                    port:p${perl_version}-digest-md5 \
                    port:p${perl_version}-mail-imapclient \
                    port:p${perl_version}-term-readkey \
                    port:p${perl_version}-io-socket-ssl \
                    port:p${perl_version}-io-tee \
                    port:p${perl_version}-datemanip \
                    port:p${perl_version}-digest-hmac \
                    port:p${perl_version}-file-copy-recursive \
                    port:p${perl_version}-unicode-string

supported_archs     noarch

post-patch {
    reinplace -locale C "s|^#!.*|#!${prefix}/bin/perl${perl_version}|g" ${worksrcpath}/imapsync
}

use_configure       no

build               {}

destroot {
    xinstall -m 755 ${worksrcpath}/imapsync ${destroot}${prefix}/bin/imapsync.pl
    ln -sf imapsync.pl ${destroot}${prefix}/bin/imapsync
    xinstall -m 755 -d ${destroot}${prefix}/share/doc/${name}
    xinstall -m 644 -W ${worksrcpath} CREDITS ChangeLog FAQ LICENSE INSTALL README \
        TODO VERSION ${destroot}${prefix}/share/doc/${name}
}

livecheck.type      regex
livecheck.url       [lindex ${master_sites} 0]
livecheck.regex     ${name}-(\[.0-9\]+)\\.tgz
